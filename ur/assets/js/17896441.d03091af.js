"use strict";(globalThis.webpackChunkmy_book=globalThis.webpackChunkmy_book||[]).push([[8401],{2691:(t,e,a)=>{a.r(e),a.d(e,{default:()=>g});var n=a(6540),o=a(8310),s=a(5475),i=a(6666),r=a(4586),l=a(4164),c=a(8774),d=a(7941),u=a(3092),h=a(4848);function g(t){const{user:e,loading:a}=(0,s.A)(),{language:g,setLanguage:m}=(0,i.o)(),{siteConfig:p}=(0,r.A)(),f=p.customFields.backendUrl,[b,w]=(0,n.useState)(""),[x,z]=(0,n.useState)(""),[j,y]=(0,n.useState)(""),[k,$]=(0,n.useState)("original"),[S,v]=(0,n.useState)(!1),[A,C]=(0,n.useState)({raw:!0,personalization:!1,translation:!1}),[_,N]=(0,n.useState)(null),{content:E}=t,P=E.metadata.source;(0,n.useEffect)(()=>{e&&(async()=>{C(t=>({...t,raw:!0}));try{const t=P.replace(/^@site/,""),e=`${p.baseUrl.replace(/\/$/,"")}${t}`,a=await fetch(e);if(!a.ok)throw new Error(`Failed to fetch raw content: ${a.statusText}`);const n=await a.text();w(n)}catch(t){N(`Could not load chapter content: ${t.message}`)}finally{C(t=>({...t,raw:!1}))}})()},[P,e,p.baseUrl]),(0,n.useEffect)(()=>{"ur"===g?(T(),v(!0)):v(!1)},[g,k,x,b]);const T=async()=>{const t="personalized"===k?x:b;if(t){C(t=>({...t,translation:!0})),N(null);try{const e=localStorage.getItem("access_token");if(!e)throw new Error("You must be logged in.");const a=await fetch(`${f}/api/v1/translate`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({content:t})});if(!a.ok)throw new Error((await a.json()).detail||"Translation failed");const n=await a.json();y(n.translated_content)}catch(e){N(`Translation failed: ${e.message}`),alert(`Translation failed: ${e.message}`)}finally{C(t=>({...t,translation:!1}))}}},I=!e&&!a;let D=null;return D=S?(0,h.jsx)(d.oz,{remarkPlugins:[u.A],children:j}):"personalized"===k?(0,h.jsx)(d.oz,{remarkPlugins:[u.A],children:x}):(0,h.jsx)(o.A,{...t}),(0,h.jsxs)(h.Fragment,{children:[e&&(0,h.jsxs)("div",{className:"margin-bottom--md button-group",children:["original"!==k&&(0,h.jsx)("button",{className:"button button--secondary button--sm",onClick:()=>{$("original"),m("en")},disabled:A.personalization||A.translation,children:"Show Original"}),"original"===k&&(0,h.jsx)("button",{className:"button button--primary button--sm",onClick:async()=>{if(x)$("personalized");else{C(t=>({...t,personalization:!0})),N(null);try{const t=localStorage.getItem("access_token");if(!t)throw new Error("You must be logged in.");const e=(()=>{const t=P.match(/\/docs\/(.+?)\.(md|mdx)$/);if(!t)throw new Error("Could not extract chapter ID.");return t[1]})(),a=await fetch(`${f}/api/v1/chapters/${e}/personalized`,{headers:{Authorization:`Bearer ${t}`}});if(!a.ok)throw new Error((await a.json()).detail||"Personalization failed");const n=await a.json();z(n.personalized_content),$("personalized")}catch(t){N(`Personalization failed: ${t.message}`),alert(`Personalization failed: ${t.message}`)}finally{C(t=>({...t,personalization:!1}))}}},disabled:A.personalization||A.raw,children:A.personalization?"Personalizing...":"Personalize Chapter"})]}),_&&(0,h.jsx)("div",{className:"alert alert--danger margin-top--sm",children:_}),(0,h.jsxs)("div",{style:{position:"relative"},children:[(0,h.jsx)("div",{className:(0,l.A)("markdown",S&&"rtl-content"),children:A.raw||S&&A.translation?(0,h.jsx)("div",{children:"Loading content..."}):D}),I&&(0,h.jsxs)("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",backgroundColor:"rgba(255, 255, 255, 0.95)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:10,textAlign:"center",flexDirection:"column",padding:"2rem"},children:[(0,h.jsx)("h1",{className:"hero__title",children:"Access Denied"}),(0,h.jsx)("p",{className:"hero__subtitle",children:"You must be logged in to view this content."}),(0,h.jsx)(c.A,{className:"button button--secondary button--lg",to:"/login",children:"Login to continue"})]})]})]})}}}]);